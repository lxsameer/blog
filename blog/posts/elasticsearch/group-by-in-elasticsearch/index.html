<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>ElasticSearch & 'Group By'</title>
    
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="JuEQr3co-5tzeF_7863YbTPjQLuaM6tmbbzNFa-8C6U" />
    <meta name="twitter:card" content="A publication about my life.">
    <meta name="twitter:site" content="@lxsameer">
    <meta name="twitter:creator" content="@lxsameer">

    
    <meta name="twitter:title" content="ElasticSearch & 'Group By'">
    
    
    <meta name="twitter:url" content="http://lxsameer.com/blog/posts/elasticsearch/group-by-in-elasticsearch/">
    
    
    <meta name="twitter:description" content="ElasticSearch & 'Group By'">
    
    
    <meta name="twitter:image:src" content="http://lxsameer.com/images/logo.png">
    


    <meta content="" property="og:site_name">
    
    <meta content="ElasticSearch & 'Group By'" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    
    <meta content="ElasticSearch & 'Group By'" property="og:description">
    
    
    <meta content="http://lxsameer.com/blog/posts/elasticsearch/group-by-in-elasticsearch/" property="og:url">
    
    
    <meta content="2015-06-20T14:02:00-07:00" property="article:published_time">
    
    
    <meta content="http://lxsameer.com/images/high-logo.png" property="og:image">
    
    
    
    <meta content="elasticsearch" property="article:section">
    
    
    
    
    <meta content="ElasticSearch" property="article:tag">
    
    

    <link rel="stylesheet" href="/assets/semantic-f98d054268e7c82acf6830a37919f359.css">
<link rel="stylesheet" href="/assets/highlights-f14b3917e3c12f98b82b0bec1a67b717.css">
<link rel="stylesheet" href="/assets/styles-6291c6e7056a3ca2d5dd1b3f5d76c7da.css">
<link rel="stylesheet" href="/assets/application-7783929a99ec797853593b61150ee6e6.css">
    <script src="/assets/lib/jquery-536b2dc81ab12d0082c7651612b50aa5.js"></script>
<script src="/assets/lib/moment-595793a2969de7e6a68cd3e605457df7.js"></script>
<script src="/assets/lib/mustache-6403e2b8718abaa09f3df612ef3bcdbb.js"></script>
<script src="/assets/lib/semantic-649d890a33ada9ba8c16e9ab25bd59f7.js"></script>
<script src="/assets/widgets-74fab660756865fee8654d54349af918.js"></script>
<script src="/assets/application-befa051770aa2d4b11b4936a8e587f3f.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
    <!-- Custom CSS -->
  </head>
  <body>
    <div class="ui computer tablet only sidebar small vertical menu">
      <div class="item">
        <div class="header">
          <a href="/categories"><i class="grid layout icon"></i> Categories</a>
        </div>
        <div class="menu">
          <div class='item'><a href='/categories/elasticsearch/'><div class='ui small blue image label'>Elasticsearch<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/faalis/'><div class='ui small purple image label'>Faalis<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/javascript/'><div class='ui small black image label'>Javascript<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/life/'><div class='ui small orange image label'>Life<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/mobiledev/'><div class='ui small blue image label'>Mobiledev<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/rails/'><div class='ui small black image label'>Rails<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/ruby/'><div class='ui small orange image label'>Ruby<div class='detail'>2</div></div></a></div>

        </div>
      </div>
      <div class="item">
        <div class="header">
          <a href="/tags"><i class="tags icon"></i> Tags</a>
        </div>
      </div>
    </div>


    <div class="ui mobile only left sidebar wide thin floating vertical menu">
      <a class="item" href="/"><i class="home icon"></i> Home</a>
      <a class="item" href="/blog"><i class="comment icon"></i> Blog</a>
      <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
      <a class="item" href="/categories"><i class="grid layout icon"></i> Categories</a>
      <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>

      <a class="item" href="/tags"><i class="tags icon"></i> Tags</a>
      <a class="item" href="/feed/feed.xml"><i class="rss icon"></i> Feed</a>
      <a class="item"  href="http://twitter.com/lxsameer"><i class="large twitter sign icon"></i>Follow me on Twitter</a>
      <a class="item"  href="http://github.com/lxsameer"><i class="large github icon"></i>Follow me on Github</a>
      <a class="item"  href="https://plus.google.com/+SameerRahmani"><i class="large google plus sign icon"></i>Follow me on Google+</a>
      <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i>Follow me on LinkedIn</a>
      <a class="item toggle button mobile" href="#"><i class="large remove icon"></i> Close</a>
    </div>



    <div class="primary pusher">



    <div class="ui fluid grid">
      <div class="row computer tablet only">
        <div class="column">
          <div class="ui blue secondary inverted main menu">
            <a href="/" class="item"><i class="home icon"></i> Home</a>
            <a href="/blog/" class="item"><i class="comment icon"></i> Blog</a>
            <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
            <a href="#" class="toggle button computer item"><i class="grid layout icon"></i> Categories</a>
            <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>
            <a class="item" href="/blog/feed/feed.xml"><i class="rss icon"></i> Feed</a>

            <div class="right menu">
              <a class="item" href="http://twitter.com/lxsameer"><i class="big twitter sign icon"></i></a>
              <a class="item" href="http://github.com/lxsameer"><i class="big github icon"></i></a>
              <a class="item" href="https://plus.google.com/+SameerRahmani"><i class="big google plus sign icon"></i></a>
              <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="row mobile only">
        <div class="column">
          <div class="ui fluid big blue inverted menu">
            <a href="#" class="toggle button mobile item"><i class="content big icon"></i></a>
          </div>
        </div>
      </div>

    </div>






      <div class="ui main container">
        <div class="stackable ui strechted page grid">
          <div class="column">
            
<div class="post row">
  <div class="ui teal top attached segment">
    <br class="mobile only"/>
    <h1 class="post-title"><a href="">ElasticSearch & 'Group By'</a></h1>
    <div class="ui teal top right attached  label"><i class="large time icon"></i>20 Jun 2015</div>

    <div class="post">
      <p><a href="https://www.elastic.co/">ElasticSearch</a> is the best Opensource search engine out there in the wild in my opinion. If
your not familiar with it, I highly recommend you to checkout <a href="http://joelabrahamsson.com/elasticsearch-101/">this awesome tutorial</a>
and get start with <a href="https://www.elastic.co/">ElasticSearch</a>.</p>

<p>while ago we did an episode on <a href="https://www.elastic.co/">ElasticSearch</a> in <a href="http://www.radioboot.com/episodes/2/">Radio Boot</a>.
After that people came to me and ask different questions about <a href="https://www.elastic.co/">ElasticSearch</a>. There was a question
which I got frequently. <strong>&quot;How can I group my result by an specific field value?&quot;</strong></p>

<p>I saw many people searching for a <strong>Group by</strong> functionality in <a href="https://www.elastic.co/">ElasticSearch</a>. So I decided to write
a blog post on this feature.</p>

<p><a href="https://www.elastic.co/">ElasticSearch</a> comes with a very handy and awesome module which is called <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.3/search-aggregations.html#search-aggregations">Aggregations Modul</a>. This module have lots of different
use cases but we want to use this one for simulate a <strong>group by</strong> functionality.</p>

<p>So Let&#39;s use the same indices from the given tutorial. I try keep this post as short as possible, So hear is what should we do:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;match_all&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">},</span>
    <span class="nt">&quot;aggs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;terms&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;genres&quot;</span>

            <span class="p">},</span>

            <span class="nt">&quot;aggs&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="nt">&quot;top_hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;include&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;year&quot;</span>
                            <span class="p">]</span>
                        <span class="p">},</span>
                        <span class="nt">&quot;size&quot;</span><span class="p">:</span> <span class="mi">100</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>As you may already know you have to <strong>POST</strong> the above json to your elastic search via <code>http://&lt;host&gt;:9200/_search</code>.
and you gonna get:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
<span class="err">...</span>
    <span class="nt">&quot;aggregations&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;doc_count_error_upper_bound&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;sum_other_doc_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nt">&quot;buckets&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;drama&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Apocalypse Now&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1979</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Godfather&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1972</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Assassination of Jesse James by the Coward Robert Ford&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2007</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Lawrence of Arabia&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1962</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Godfather&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1972</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;crime&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Kill Bill: Vol. 1&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2003</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Godfather&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1972</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Assassination of Jesse James by the Coward Robert Ford&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2007</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Godfather&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1972</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;biography&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;The Assassination of Jesse James by the Coward Robert Ford&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2007</span>
                                    <span class="p">}</span>
                                <span class="p">},</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Lawrence of Arabia&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1962</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;action&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Kill Bill: Vol. 1&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2003</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;adventure&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Lawrence of Arabia&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1962</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;thriller&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Kill Bill: Vol. 1&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">2003</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;war&quot;</span><span class="p">,</span>
                    <span class="nt">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="nt">&quot;genres&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;max_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="nt">&quot;hits&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span>
                                    <span class="nt">&quot;_index&quot;</span><span class="p">:</span> <span class="s2">&quot;movies&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;movie&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
                                    <span class="nt">&quot;_score&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                    <span class="nt">&quot;_source&quot;</span><span class="p">:</span> <span class="p">{</span>
                                        <span class="nt">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Apocalypse Now&quot;</span><span class="p">,</span>
                                        <span class="nt">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1979</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="err">...</span>
<span class="p">}</span>
</code></pre></div>

<p>I partially pasted the result. Ok let&#39;s break down the query.</p>

<p>Here is the basic template for creating an aggregation in elastic search:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="s2">&quot;aggregations&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="nt">&quot;&lt;aggregation_name&gt;&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;&lt;aggregation_type&gt;&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="err">&lt;aggregation_body&gt;</span>
        <span class="p">}</span>
        <span class="p">[,</span><span class="s2">&quot;aggregations&quot;</span><span class="err">:</span> <span class="p">{</span> <span class="err">[&lt;sub_aggregation&gt;]+</span> <span class="p">}</span> <span class="p">]</span><span class="err">?</span>
    <span class="p">}</span>
    <span class="p">[,</span><span class="s2">&quot;&lt;aggregation_name_2&gt;&quot;</span><span class="err">:</span> <span class="p">{</span> <span class="err">...</span> <span class="p">}</span> <span class="p">]</span><span class="err">*</span>
<span class="p">}</span>
</code></pre></div>

<p>So you can see that we simply defined an aggregation called <code>genres</code> which aggregate the result based on
<code>genres</code> field of indices. Using <code>top_hits</code> and <code>include</code> we extends our result to contains <code>title</code> and <code>year</code>
fields of each matching index.</p>

<p>I tried to write a short post (yeah, you wish), but if you need to know the details, please take a look at
(Aggregations)[https://www.elastic.co/guide/en/elasticsearch/reference/1.3/search-aggregations.html] in official
guide of ElasticSearch.</p>

    </div>

    <div class="ui grid">
      <div class="right aligned row">
        <div class="column">
          <div class="ui tiny orange labeled icon top right pointing dropdown button">
            <i class="share icon"></i>
            <span class="text">Share</span>
            <div class="menu">
              <div class="item"><a href="https://twitter.com/intent/tweet?source=Yellowen_inc&text=ElasticSearch+%26+%27Group+By%27&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Felasticsearch%2Fgroup-by-in-elasticsearch%2F" class=""><i class="large twitter sign icon"></i> Twitter</a></div>
              <div class="item"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Felasticsearch%2Fgroup-by-in-elasticsearch%2F&t=ElasticSearch+%26+%27Group+By%27" class=""><i class="large facebook sign icon"></i> Facebook</a></div>
              <div class="item"><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Felasticsearch%2Fgroup-by-in-elasticsearch%2F&title=ElasticSearch+%26+%27Group+By%27&summary=ElasticSearch+%26+%27Group+By%27&source=lxsameer%5C%27s+Blog" class=""><i class="large linkedin sign icon"></i> Linkedin</a></div>
              <div class="item"><a href="https://plus.google.com/share?text=ElasticSearch+%26+%27Group+By%27&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Felasticsearch%2Fgroup-by-in-elasticsearch%2F" class=""><i class="large google plus sign icon"></i> Google+</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui bottom attached black inverted segment">
    <div class="ui two column grid">
      <div class="column fsegment">
        <i class="block layout icon" title="Categories"></i> <a class="invert-link" href="/categories/elasticsearch">Elasticsearch</a> 

      </div>
      <div class="right aligned column fsegment">
        <i class="tags icon" title="Tags"></i>  <a class="invert-link" href="/tags/ElasticSearch">Elasticsearch</a> 


      </div>
    </div>
  </div>
</div>
<br />
<br />
<div class="row author">
  <div class="ui green segment">
    <h1><img class="ui mini circular image" src="http://www.gravatar.com/avatar/15482f7b6361b463ea4b113d5a502400" title="Sameer Rahmani" style="display: inline;"> lxsameer</h1>
    <div class="ui top right attached green  label">About Author</div>
    <p><p>A Bad-ass developer who loves programming and enjoy learning new stuff. He is a senior developer in <a href="http://Yellowen.com">Yellowen</a> and manage some of the <strong>Yellowen</strong> free software projects. He enjoys software development, Electronics, Training Kyokushin Karate and play music.</p>
</p>
    <div class="ui two column grid">
      <div class="row">

        <div class="column">
          
          <span class="ohloh">
          <a href='https://www.ohloh.net/accounts/35021?ref=Tiny' target='_blank'><img alt='Ohloh profile for Sameer Rahmani' border='0' height='15' src='https://www.ohloh.net/accounts/35021/widgets/account_tiny.gif' width='80' /></a>
          </span>
          
        </div>

        <div class="right aligned column">
          
          <a href="http://www.lxsameer.com"><i class="large globe icon"></i></a>
          
          
          <a href="http://twitter.com/lxsameer"><i class="large twitter icon"></i></a>
          
          
          <a href="http://github.com/lxsameer"><i class="large github icon"></i></a>
          
          
          <a href="ir.linkedin.com/pub/sameer-rahmani/54/407/423/"><i class="large linkedin icon"></i></a>
          
    </div></div></div>
  </div>
</div>

<br /><br />
<div class="row comment">
  <div class="ui segment">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'lxblog'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>

          </div>
        </div>
      </div>
      <footer>
        <div class="ui two column page grid">
          <div class="row">
            <div class="column left aligned">
              <span>Â© 2012-2015 <a class="invert" href="http://www.lxsameer.com">@lxsameer</a></span>
            </div>
            <div class="column right aligned">
              <!-- Last build: 2016-05-27 -->
              <a href="https://www.easyname.ch/de/hosting"><img src="http://assets.iranonrails.ir/images/easyname_grey.png" alt="domain" style="height: 20px" /></a>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script>
     $(".ui.dropdown").dropdown();
     $(".ui.computer.sidebar").sidebar('setting', 'transision', 'push').sidebar('attach events', '.toggle.button.computer');
     $(".ui.mobile.sidebar").sidebar('attach events', '.toggle.button.mobile');
     $('.special.cards .image').dimmer({
         on: 'hover'
     });
     $('.ui.rating').rating('disable', true);
     $('.tada').transition('set looping').transition('tada', '600ms');
    </script>

    <script id="push-template" type="x-tmpl-mustache">
      <div class="push item">
        <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Pushed to <span class="branch"><div class="ui mini label">[[ branch ]]</div></span> at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
        [[#commits]]
          <div class="item">
            <a href="https://www.github.com/[[ repo ]]/commit/[[ sha ]]"><span class="ui [[color ]] tiny label">[[ short_sha ]]</span> </a><spen class="desc">  [[ message ]] </spen>
          </div>
        [[/commits]]
        </div>
      </div>
    </script>

    <script id="create-template" type="x-tmpl-mustache">
      <div class="create item">
     <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Created a new [[ type ]] at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
          <div class="item">
            <div class='desc'><div class="ui tiny [[ color ]] label">[[ ref ]]</div> [[ desc ]] </div>
          </div>
        </div>
      </div>
    </script>
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-64266845-1', 'auto');
     ga('send', 'pageview');

    </script>
  </body>
</html>
