<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Serving multiple sites via same Rails application</title>
    
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="JuEQr3co-5tzeF_7863YbTPjQLuaM6tmbbzNFa-8C6U" />
    <meta name="twitter:card" content="A publication about my life.">
    <meta name="twitter:site" content="@lxsameer">
    <meta name="twitter:creator" content="@lxsameer">

    
    <meta name="twitter:title" content="Serving multiple sites via same Rails application">
    
    
    <meta name="twitter:url" content="http://lxsameer.com/blog/posts/ruby/rails/site-framework/">
    
    
    <meta name="twitter:description" content="Serving multiple sites via same Rails application">
    
    
    <meta name="twitter:image:src" content="http://lxsameer.com/images/logo.png">
    


    <meta content="" property="og:site_name">
    
    <meta content="Serving multiple sites via same Rails application" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    
    <meta content="Serving multiple sites via same Rails application" property="og:description">
    
    
    <meta content="http://lxsameer.com/blog/posts/ruby/rails/site-framework/" property="og:url">
    
    
    <meta content="2015-06-20T14:02:00-07:00" property="article:published_time">
    
    
    <meta content="http://lxsameer.com/images/high-logo.png" property="og:image">
    
    
    
    <meta content="ruby" property="article:section">
    
    
    
    
    <meta content="site_framework" property="article:tag">
    
    

    <link rel="stylesheet" href="/assets/semantic-f98d054268e7c82acf6830a37919f359.css">
<link rel="stylesheet" href="/assets/highlights-f14b3917e3c12f98b82b0bec1a67b717.css">
<link rel="stylesheet" href="/assets/styles-6291c6e7056a3ca2d5dd1b3f5d76c7da.css">
<link rel="stylesheet" href="/assets/application-7783929a99ec797853593b61150ee6e6.css">
    <script src="/assets/lib/jquery-536b2dc81ab12d0082c7651612b50aa5.js"></script>
<script src="/assets/lib/moment-595793a2969de7e6a68cd3e605457df7.js"></script>
<script src="/assets/lib/mustache-6403e2b8718abaa09f3df612ef3bcdbb.js"></script>
<script src="/assets/lib/semantic-649d890a33ada9ba8c16e9ab25bd59f7.js"></script>
<script src="/assets/widgets-74fab660756865fee8654d54349af918.js"></script>
<script src="/assets/application-befa051770aa2d4b11b4936a8e587f3f.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
    <!-- Custom CSS -->
  </head>
  <body>
    <div class="ui computer tablet only sidebar small vertical menu">
      <div class="item">
        <div class="header">
          <a href="/categories"><i class="grid layout icon"></i> Categories</a>
        </div>
        <div class="menu">
          <div class='item'><a href='/categories/elasticsearch/'><div class='ui small purple image label'>Elasticsearch<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/faalis/'><div class='ui small green image label'>Faalis<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/javascript/'><div class='ui small green image label'>Javascript<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/life/'><div class='ui small green image label'>Life<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/mobiledev/'><div class='ui small teal image label'>Mobiledev<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/rails/'><div class='ui small red image label'>Rails<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/ruby/'><div class='ui small red image label'>Ruby<div class='detail'>2</div></div></a></div>

        </div>
      </div>
      <div class="item">
        <div class="header">
          <a href="/tags"><i class="tags icon"></i> Tags</a>
        </div>
      </div>
    </div>


    <div class="ui mobile only left sidebar wide thin floating vertical menu">
      <a class="item" href="/"><i class="home icon"></i> Home</a>
      <a class="item" href="/blog"><i class="comment icon"></i> Blog</a>
      <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
      <a class="item" href="/categories"><i class="grid layout icon"></i> Categories</a>
      <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>

      <a class="item" href="/tags"><i class="tags icon"></i> Tags</a>
      <a class="item" href="/feed/feed.xml"><i class="rss icon"></i> Feed</a>
      <a class="item"  href="http://twitter.com/lxsameer"><i class="large twitter sign icon"></i>Follow me on Twitter</a>
      <a class="item"  href="http://github.com/lxsameer"><i class="large github icon"></i>Follow me on Github</a>
      <a class="item"  href="https://plus.google.com/+SameerRahmani"><i class="large google plus sign icon"></i>Follow me on Google+</a>
      <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i>Follow me on LinkedIn</a>
      <a class="item toggle button mobile" href="#"><i class="large remove icon"></i> Close</a>
    </div>



    <div class="primary pusher">



    <div class="ui fluid grid">
      <div class="row computer tablet only">
        <div class="column">
          <div class="ui blue secondary inverted main menu">
            <a href="/" class="item"><i class="home icon"></i> Home</a>
            <a href="/blog/" class="item"><i class="comment icon"></i> Blog</a>
            <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
            <a href="#" class="toggle button computer item"><i class="grid layout icon"></i> Categories</a>
            <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>
            <a class="item" href="/blog/feed/feed.xml"><i class="rss icon"></i> Feed</a>

            <div class="right menu">
              <a class="item" href="http://twitter.com/lxsameer"><i class="big twitter sign icon"></i></a>
              <a class="item" href="http://github.com/lxsameer"><i class="big github icon"></i></a>
              <a class="item" href="https://plus.google.com/+SameerRahmani"><i class="big google plus sign icon"></i></a>
              <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="row mobile only">
        <div class="column">
          <div class="ui fluid big blue inverted menu">
            <a href="#" class="toggle button mobile item"><i class="content big icon"></i></a>
          </div>
        </div>
      </div>

    </div>






      <div class="ui main container">
        <div class="stackable ui strechted page grid">
          <div class="column">
            
<div class="post row">
  <div class="ui teal top attached segment">
    <br class="mobile only"/>
    <h1 class="post-title"><a href="">Serving multiple sites via same Rails application</a></h1>
    <div class="ui teal top right attached  label"><i class="large time icon"></i>20 Jun 2015</div>

    <div class="post">
      <p>If you&#39;re a <a href="https://www.djangoproject.com/">Django</a> developer you probably know about its wonderful <a href="https://docs.djangoproject.com/en/1.8/ref/contrib/sites/">sites framework</a>.</p>

<blockquote>
<p>Django comes with an optional “sites” framework. It’s a hook for associating objects and functionality to particular Web sites, and it’s a holding place for the domain names and “verbose” names of your Django-powered sites.</p>

<p>Use it if your single Django installation powers more than one site and you need to differentiate between those sites in some way.</p>
</blockquote>

<p>Using Sites framework of <strong>Djangoo</strong> your can serve different websites with different contents via a single installation
of your Django application.</p>

<p>As an Ex-pythonist I really loved this feature and used it a lot. After moving to <a href="http://ruby-lang.org">Ruby</a> and
<a href="http://rubyonrails.org/">RubyOnRails</a> I found out that there was a hole in Rails world for this feature.Ofcourse there
are <a href="http://api.rubyonrails.org/classes/ActionDispatch/Routing/Mapper/Scoping.html#method-i-constraints">Constraints</a>, but still
there weren&#39;t any complete and integrate solution.</p>

<p>Since we needed a feature like <strong>Django</strong>&#39;s sites framework in one of our projects in our team. I pulled my self together and
decided to build one. After spending to much time and prototyping lots of solution I finally came up with <strong><a href="https://rubygems.org/gems/site_framework/versions/1.0.2">SiteFramework</a></strong> gem.</p>

<p><a href="https://rubygems.org/gems/site_framework/versions/1.0.2">SiteFramework</a> is a Rails engine that provides some helpers and models which
allows you to simply categorize your routes for different sites and serve your contents based on the current site, user is visiting.</p>

<p>I&#39;m going to give you an introduction to <a href="https://rubygems.org/gems/site_framework/versions/1.0.2">SiteFramework</a> and how to use it.
Fasten you seat belts folks.</p>

<h2>Installation</h2>

<p>Add <code>site_framework</code> to your <code>Gemfile</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">gem</span> <span class="s1">&#39;site_framework&#39;</span>
</code></pre></div>

<p>and after installing your project dependencies using <code>bundle install</code> command. Install
<strong>SiteFramework</strong> migrations like:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">rake site_framework:install:migrations
</code></pre></div>

<p>That&#39;s it.</p>

<h2>Usage</h2>

<p><strong>SiteFramework</strong> provides to solution to multi-site support.</p>

<p>In both solution you have to add a migration for your tables and
make them domain aware (ActiveRecord Only). e.g in your migration:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Make posts table domain aware</span>
<span class="n">domain_aware</span><span class="p">(</span><span class="ss">:posts</span><span class="p">)</span>
</code></pre></div>

<p>If you&#39;re using <strong>Mongoid</strong> just add a reference to <strong>SiteFramework::Domain</strong> in your model.</p>

<p>When a request arrives to the Rails application <code>SiteFramework</code> will add three different
methods to <code>Rails.application</code>.</p>

<ul>
<li><strong>domain</strong>: An instance of <code>SiteFramework::Domain</code> model which refer to current domain of
the request</li>
<li><strong>domain_name</strong>: Current domain as string.</li>
<li><strong>Site</strong>: An instance of <code>SiteFramework::Site</code> model which refer to current site.</li>
</ul>

<h3>A) Rack middleware:</h3>

<p>Simply add <code>SiteFramework::Middleware</code> to your middleware stack.</p>

<h3>B) Constrants</h3>

<p>Just use <code>sites</code> DSL in your <code>routes.rb</code>. e.g:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>

  <span class="c1"># Share routes</span>
  <span class="n">get</span> <span class="s1">&#39;home/index&#39;</span>

  <span class="c1"># All the routes defined in this section will be domain aware.</span>
  <span class="n">sites</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">root</span> <span class="s1">&#39;home#index&#39;</span>
  <span class="k">end</span>

  <span class="n">default_site</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># routs for default site</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>Note: You can provide default domains for <strong>SiteFramework</strong> via an
initializer like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">SiteFramework</span><span class="o">.</span><span class="n">setup</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">default_domains</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;example.com&#39;</span><span class="o">]</span>

<span class="k">end</span>
</code></pre></div>

<p><strong>Personally I prefer this (B) option since it&#39;s more Railish.</strong></p>

<h3>Model Concern</h3>

<p><strong>SiteFramework</strong> provides an <strong>ActiveSupport</strong> concern which transparently
makes your models aware of the current <strong>Site</strong> and <strong>Domain</strong>. By includeing
<code>SiteFramework::DomainAware</code> into your model, default scope of your model will
change to return only records which belongs to current <strong>Site</strong>.</p>

<p>This way you can use external gems with your multi-site application easily.
All you have to do is to open there models and include the given concern.</p>

<p>Piece of cake. right?</p>

<h2>Models</h2>

<p><strong>SiteFramework</strong> comes with a sets of models to help you build you application
easily.</p>

<ul>
<li><p><strong>Domain</strong>: This model stores all the models that should be serviced via the
          application.</p></li>
<li><p><strong>Site</strong>:   Holds each site instance configuration.</p></li>
</ul>

<p>This is really streight forward. To check out the fields of these two model take
a look at the migrations that are copied into you main application.</p>

<p>Have fun. :)</p>

    </div>

    <div class="ui grid">
      <div class="right aligned row">
        <div class="column">
          <div class="ui tiny orange labeled icon top right pointing dropdown button">
            <i class="share icon"></i>
            <span class="text">Share</span>
            <div class="menu">
              <div class="item"><a href="https://twitter.com/intent/tweet?source=Yellowen_inc&text=Serving+multiple+sites+via+same+Rails+application&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fruby%2Frails%2Fsite-framework%2F" class=""><i class="large twitter sign icon"></i> Twitter</a></div>
              <div class="item"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fruby%2Frails%2Fsite-framework%2F&t=Serving+multiple+sites+via+same+Rails+application" class=""><i class="large facebook sign icon"></i> Facebook</a></div>
              <div class="item"><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fruby%2Frails%2Fsite-framework%2F&title=Serving+multiple+sites+via+same+Rails+application&summary=Serving+multiple+sites+via+same+Rails+application&source=lxsameer%5C%27s+Blog" class=""><i class="large linkedin sign icon"></i> Linkedin</a></div>
              <div class="item"><a href="https://plus.google.com/share?text=Serving+multiple+sites+via+same+Rails+application&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fruby%2Frails%2Fsite-framework%2F" class=""><i class="large google plus sign icon"></i> Google+</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui bottom attached black inverted segment">
    <div class="ui two column grid">
      <div class="column fsegment">
        <i class="block layout icon" title="Categories"></i> <a class="invert-link" href="/categories/ruby">Ruby</a> <a class="invert-link" href="/categories/rails">Rails</a> 

      </div>
      <div class="right aligned column fsegment">
        <i class="tags icon" title="Tags"></i>  <a class="invert-link" href="/tags/site_framework">Site_framework</a> 


      </div>
    </div>
  </div>
</div>
<br />
<br />
<div class="row author">
  <div class="ui green segment">
    <h1><img class="ui mini circular image" src="http://www.gravatar.com/avatar/15482f7b6361b463ea4b113d5a502400" title="Sameer Rahmani" style="display: inline;"> lxsameer</h1>
    <div class="ui top right attached green  label">About Author</div>
    <p><p>A Bad-ass developer who loves programming and enjoy learning new stuff. He is a senior developer in <a href="http://Yellowen.com">Yellowen</a> and manage some of the <strong>Yellowen</strong> free software projects. He enjoys software development, Electronics, Training Kyokushin Karate and play music.</p>
</p>
    <div class="ui two column grid">
      <div class="row">

        <div class="column">
          
          <span class="ohloh">
          <a href='https://www.ohloh.net/accounts/35021?ref=Tiny' target='_blank'><img alt='Ohloh profile for Sameer Rahmani' border='0' height='15' src='https://www.ohloh.net/accounts/35021/widgets/account_tiny.gif' width='80' /></a>
          </span>
          
        </div>

        <div class="right aligned column">
          
          <a href="http://www.lxsameer.com"><i class="large globe icon"></i></a>
          
          
          <a href="http://twitter.com/lxsameer"><i class="large twitter icon"></i></a>
          
          
          <a href="http://github.com/lxsameer"><i class="large github icon"></i></a>
          
          
          <a href="ir.linkedin.com/pub/sameer-rahmani/54/407/423/"><i class="large linkedin icon"></i></a>
          
    </div></div></div>
  </div>
</div>

<br /><br />
<div class="row comment">
  <div class="ui segment">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'lxblog'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>

          </div>
        </div>
      </div>
      <footer>
        <div class="ui two column page grid">
          <div class="row">
            <div class="column left aligned">
              <span>© 2012-2015 <a class="invert" href="http://www.lxsameer.com">@lxsameer</a></span>
            </div>
            <div class="column right aligned">
              <!-- Last build: 2016-05-27 -->
              <a href="https://www.easyname.ch/de/hosting"><img src="http://assets.iranonrails.ir/images/easyname_grey.png" alt="domain" style="height: 20px" /></a>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script>
     $(".ui.dropdown").dropdown();
     $(".ui.computer.sidebar").sidebar('setting', 'transision', 'push').sidebar('attach events', '.toggle.button.computer');
     $(".ui.mobile.sidebar").sidebar('attach events', '.toggle.button.mobile');
     $('.special.cards .image').dimmer({
         on: 'hover'
     });
     $('.ui.rating').rating('disable', true);
     $('.tada').transition('set looping').transition('tada', '600ms');
    </script>

    <script id="push-template" type="x-tmpl-mustache">
      <div class="push item">
        <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Pushed to <span class="branch"><div class="ui mini label">[[ branch ]]</div></span> at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
        [[#commits]]
          <div class="item">
            <a href="https://www.github.com/[[ repo ]]/commit/[[ sha ]]"><span class="ui [[color ]] tiny label">[[ short_sha ]]</span> </a><spen class="desc">  [[ message ]] </spen>
          </div>
        [[/commits]]
        </div>
      </div>
    </script>

    <script id="create-template" type="x-tmpl-mustache">
      <div class="create item">
     <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Created a new [[ type ]] at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
          <div class="item">
            <div class='desc'><div class="ui tiny [[ color ]] label">[[ ref ]]</div> [[ desc ]] </div>
          </div>
        </div>
      </div>
    </script>
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-64266845-1', 'auto');
     ga('send', 'pageview');

    </script>
  </body>
</html>
