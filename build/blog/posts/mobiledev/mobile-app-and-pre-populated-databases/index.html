<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Mobile Apps & pre-populated databases</title>
    
    <meta name="viewport" content="width=device-width">
    <meta name="google-site-verification" content="JuEQr3co-5tzeF_7863YbTPjQLuaM6tmbbzNFa-8C6U" />
    <meta name="twitter:card" content="A publication about my life.">
    <meta name="twitter:site" content="@lxsameer">
    <meta name="twitter:creator" content="@lxsameer">

    
    <meta name="twitter:title" content="Mobile Apps & pre-populated databases">
    
    
    <meta name="twitter:url" content="http://lxsameer.com/blog/posts/mobiledev/mobile-app-and-pre-populated-databases/">
    
    
    <meta name="twitter:description" content="Mobile app development and re-populated databases challenge">
    
    
    <meta name="twitter:image:src" content="http://lxsameer.com/images/logo.png">
    


    <meta content="" property="og:site_name">
    
    <meta content="Mobile Apps & pre-populated databases" property="og:title">
    
    
    <meta content="article" property="og:type">
    
    
    <meta content="Mobile app development and re-populated databases challenge" property="og:description">
    
    
    <meta content="http://lxsameer.com/blog/posts/mobiledev/mobile-app-and-pre-populated-databases/" property="og:url">
    
    
    <meta content="2014-09-24T22:41:00-07:00" property="article:published_time">
    
    
    <meta content="http://lxsameer.com/images/high-logo.png" property="og:image">
    
    
    
    <meta content="mobiledev" property="article:section">
    
    
    
    
    <meta content="Susanoo" property="article:tag">
    
    <meta content="Cordova" property="article:tag">
    
    <meta content="Phonegap" property="article:tag">
    
    

    <link rel="stylesheet" href="/assets/semantic-f98d054268e7c82acf6830a37919f359.css">
<link rel="stylesheet" href="/assets/highlights-f14b3917e3c12f98b82b0bec1a67b717.css">
<link rel="stylesheet" href="/assets/styles-6291c6e7056a3ca2d5dd1b3f5d76c7da.css">
<link rel="stylesheet" href="/assets/application-7783929a99ec797853593b61150ee6e6.css">
    <script src="/assets/lib/jquery-536b2dc81ab12d0082c7651612b50aa5.js"></script>
<script src="/assets/lib/moment-595793a2969de7e6a68cd3e605457df7.js"></script>
<script src="/assets/lib/mustache-6403e2b8718abaa09f3df612ef3bcdbb.js"></script>
<script src="/assets/lib/semantic-649d890a33ada9ba8c16e9ab25bd59f7.js"></script>
<script src="/assets/widgets-74fab660756865fee8654d54349af918.js"></script>
<script src="/assets/application-befa051770aa2d4b11b4936a8e587f3f.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
    <!-- Custom CSS -->
  </head>
  <body>
    <div class="ui computer tablet only sidebar small vertical menu">
      <div class="item">
        <div class="header">
          <a href="/categories"><i class="grid layout icon"></i> Categories</a>
        </div>
        <div class="menu">
          <div class='item'><a href='/categories/elasticsearch/'><div class='ui small green image label'>Elasticsearch<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/faalis/'><div class='ui small blue image label'>Faalis<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/javascript/'><div class='ui small green image label'>Javascript<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/life/'><div class='ui small purple image label'>Life<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/mobiledev/'><div class='ui small purple image label'>Mobiledev<div class='detail'>1</div></div></a></div>
<div class='item'><a href='/categories/rails/'><div class='ui small purple image label'>Rails<div class='detail'>2</div></div></a></div>
<div class='item'><a href='/categories/ruby/'><div class='ui small black image label'>Ruby<div class='detail'>2</div></div></a></div>

        </div>
      </div>
      <div class="item">
        <div class="header">
          <a href="/tags"><i class="tags icon"></i> Tags</a>
        </div>
      </div>
    </div>


    <div class="ui mobile only left sidebar wide thin floating vertical menu">
      <a class="item" href="/"><i class="home icon"></i> Home</a>
      <a class="item" href="/blog"><i class="comment icon"></i> Blog</a>
      <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
      <a class="item" href="/categories"><i class="grid layout icon"></i> Categories</a>
      <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>

      <a class="item" href="/tags"><i class="tags icon"></i> Tags</a>
      <a class="item" href="/feed/feed.xml"><i class="rss icon"></i> Feed</a>
      <a class="item"  href="http://twitter.com/lxsameer"><i class="large twitter sign icon"></i>Follow me on Twitter</a>
      <a class="item"  href="http://github.com/lxsameer"><i class="large github icon"></i>Follow me on Github</a>
      <a class="item"  href="https://plus.google.com/+SameerRahmani"><i class="large google plus sign icon"></i>Follow me on Google+</a>
      <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i>Follow me on LinkedIn</a>
      <a class="item toggle button mobile" href="#"><i class="large remove icon"></i> Close</a>
    </div>



    <div class="primary pusher">



    <div class="ui fluid grid">
      <div class="row computer tablet only">
        <div class="column">
          <div class="ui blue secondary inverted main menu">
            <a href="/" class="item"><i class="home icon"></i> Home</a>
            <a href="/blog/" class="item"><i class="comment icon"></i> Blog</a>
            <!-- <a href="/activities/" class="item"><i class="terminal icon"></i> Activities</a> -->
            <a href="#" class="toggle button computer item"><i class="grid layout icon"></i> Categories</a>
            <a href="/portfolio/" class="item"><i class="trophy icon"></i> Portfolio</a>
            <a class="item" href="/blog/feed/feed.xml"><i class="rss icon"></i> Feed</a>

            <div class="right menu">
              <a class="item" href="http://twitter.com/lxsameer"><i class="big twitter sign icon"></i></a>
              <a class="item" href="http://github.com/lxsameer"><i class="big github icon"></i></a>
              <a class="item" href="https://plus.google.com/+SameerRahmani"><i class="big google plus sign icon"></i></a>
              <a class="item"  href="https://ir.linkedin.com/in/lxsameer"><i class="large linkedin icon"></i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="row mobile only">
        <div class="column">
          <div class="ui fluid big blue inverted menu">
            <a href="#" class="toggle button mobile item"><i class="content big icon"></i></a>
          </div>
        </div>
      </div>

    </div>






      <div class="ui main container">
        <div class="stackable ui strechted page grid">
          <div class="column">
            
<div class="post row">
  <div class="ui teal top attached segment">
    <br class="mobile only"/>
    <h1 class="post-title"><a href="">Mobile Apps & pre-populated databases</a></h1>
    <div class="ui teal top right attached  label"><i class="large time icon"></i>24 Sep 2014</div>

    <div class="post">
      <p>In the past couple of weeks I was working on Mobile application which was a math related game. As always
I used our beloved <a href="http://github.com/Yellowen/Susanoo">Susanoo</a> framework for the task which use
<a href="http://cordova.apache.org/">Apache Cordova</a> internally.</p>

<p>But I experienced a problem. The Game had a database with 38,000 records. If you have never developed a
mobile application, it may seem odd to you because 38,000 records is not that big a deal. Unfortunately
This number is kind of a big deal for a mobile application. Because the application may run on different
types of devices with different type of hardware. Long story short <strong>It&#39;s a big deal</strong>.</p>

<p>To face this problem I had these choices:</p>

<ul>
<li>SQLite</li>
<li>WebSQL or IndexedDB</li>
<li>Single JSON (or any other format) file</li>
<li>Multiple JSON file</li>
</ul>

<p>Using <strong>SQLite</strong> and a native <strong>Android</strong> driver a single SQL <code>SELECT</code> query to retrieve a single row
took about 18 seconds on a quad core device (Sony Xperia Z). It was a <strong>disaster</strong>.</p>

<p><strong>WebSQL</strong> and <strong>IndexedDB</strong> were out of the picture too. Because spending a lot of time on putting
data from a pre-populated data storage like <code>JSON</code> file into these databases took bout 30 minutes on
the same device. No one likes to wait for 30 minutes for a simple math game.</p>

<p>I had better performance with a single <code>JSON</code> file on my device. It was a bit slow but eeeh. But when
it comes to install the game on a single core device. <strong>Ka-BOOOOOOOM</strong> Slower devices couldn&#39;t even load the file.</p>

<p>So I tried my last resort. I broke the single <code>JSON</code> file into smaller piece. The original file was about 10Mb
and I tried different combination of broke down. For example, I broke the file into 38,000 pieces based on
row IDs or I broke the file into about 300 files based on game levels and so on. The problem with this
approach was the <strong>SIZE</strong>. Total size of 38,000 records gets about 150Mb. Who want to download a 160Mb
math game?</p>

<p>You probably are waiting for me to introduce you to the solution, don&#39;t you?</p>

<p>Ok Here is what have I done. I simply created a binary database by serializing my data into a series of
bytes and separate records using one byte separator. here is a part of my data:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="lineno"> 1</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="lineno"> 2</span> <span class="sd">00 0c 0f 05 08 64 0b 09 02 64 09 06 03 65 00 0a</span>
<span class="lineno"> 3</span> <span class="sd">06 0e 0a 64 0c 04 08 64 08 02 06 65 00 05 06 0c</span>
<span class="lineno"> 4</span> <span class="sd">0d 64 09 01 08 64 09 05 04 65 00 0e 0a 0f 0b 64</span>
<span class="lineno"> 5</span> <span class="sd">0d 06 07 64 0c 04 08 65 00 0d 0a 0e 0b 64 0f 07</span>
<span class="lineno"> 6</span> <span class="sd">08 64 09 03 06 65 00 0e 0c 0b 09 64 0f 09 06 64</span>
<span class="lineno"> 7</span> <span class="sd">08 03 05 65 00 07 09 05 07 64 06 04 02 64 08 05</span>
<span class="lineno"> 8</span> <span class="sd">03 65 00 06 07 08 09 64 0a 04 06 64 05 03 02 65</span>
<span class="lineno"> 9</span> <span class="sd">00 06 0d 05 0c 64 07 04 03 64 0b 09 02 65 00 0b</span>
<span class="lineno">10</span> <span class="sd">0e 04 07 64 09 08 01 64 09 06 03 65 00 0a 0b 0b</span>
<span class="lineno">11</span> <span class="sd">0c 64 11 08 09 64 05 03 02 65 00 0e 0a 0b 07 64</span>
<span class="lineno">12</span> <span class="sd">&quot;&quot;&quot;</span></code></pre></div>

<p>As you can see (probably) I separate my records using <code>65</code> (<code>e</code> in <code>ASCII</code>). And <code>64</code>
to separate my fields (Since my data in just some numbers, it wasn&#39;t a problem to use
separators in alphabet range). With this approach my data shrank to only 350Kb which was
much smaller. Long story short, I parsed my data in javascript like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="lineno"> 1</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse_bytes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 2</span>         <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{};</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>         <span class="c1">// Parse the first byte as the level field</span>
<span class="lineno"> 5</span>         <span class="nx">result</span><span class="p">.</span><span class="nx">level</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="lineno"> 6</span> 
<span class="lineno"> 7</span>         <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">);</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>         <span class="kd">var</span> <span class="nx">rows</span> <span class="o">=</span> <span class="p">[];</span>
<span class="lineno">10</span> 
<span class="lineno">11</span>         <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">parts</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">12</span>             <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="p">[];</span>
<span class="lineno">13</span>             <span class="c1">// Loop through the bytes of a field to create its value</span>
<span class="lineno">14</span>             <span class="c1">// which is an array.</span>
<span class="lineno">15</span>             <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno">16</span>                 <span class="nx">row</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
<span class="lineno">17</span>             <span class="p">}</span>
<span class="lineno">18</span> 
<span class="lineno">19</span>             <span class="nx">rows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
<span class="lineno">20</span>         <span class="p">});</span>
<span class="lineno">21</span> 
<span class="lineno">22</span>         <span class="nx">result</span><span class="p">.</span><span class="nx">first_row</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
<span class="lineno">23</span>         <span class="nx">result</span><span class="p">.</span><span class="nx">rest_of_rows</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">;</span>
<span class="lineno">24</span> 
<span class="lineno">25</span>         <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="lineno">26</span>     <span class="p">};</span></code></pre></div>

<p>As you see the above code is not even a <strong>well written</strong> Javascript code and it can
be re-factored to be more efficient, but using the above snippet it took only <strong>0.3ms</strong>
to load the entire database and fire a query in the same device. It&#39;s big isn&#39;t it.</p>

<p>If your data is bigger than mine or you have a very complex structure the only thing
you can do is, to use <strong>WebServices</strong>.</p>

<p>I hope this was helpful. :)</p>

    </div>

    <div class="ui grid">
      <div class="right aligned row">
        <div class="column">
          <div class="ui tiny orange labeled icon top right pointing dropdown button">
            <i class="share icon"></i>
            <span class="text">Share</span>
            <div class="menu">
              <div class="item"><a href="https://twitter.com/intent/tweet?source=Yellowen_inc&text=Mobile+Apps+%26+pre-populated+databases&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fmobiledev%2Fmobile-app-and-pre-populated-databases%2F" class=""><i class="large twitter sign icon"></i> Twitter</a></div>
              <div class="item"><a href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fmobiledev%2Fmobile-app-and-pre-populated-databases%2F&t=Mobile+Apps+%26+pre-populated+databases" class=""><i class="large facebook sign icon"></i> Facebook</a></div>
              <div class="item"><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fmobiledev%2Fmobile-app-and-pre-populated-databases%2F&title=Mobile+Apps+%26+pre-populated+databases&summary=Mobile+app+development+and+re-populated+databases+challenge&source=lxsameer%5C%27s+Blog" class=""><i class="large linkedin sign icon"></i> Linkedin</a></div>
              <div class="item"><a href="https://plus.google.com/share?text=Mobile+Apps+%26+pre-populated+databases&url=http%3A%2F%2Flxsameer.com%2Fblog%2Fposts%2Fmobiledev%2Fmobile-app-and-pre-populated-databases%2F" class=""><i class="large google plus sign icon"></i> Google+</a></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="ui bottom attached black inverted segment">
    <div class="ui two column grid">
      <div class="column fsegment">
        <i class="block layout icon" title="Categories"></i> <a class="invert-link" href="/categories/mobiledev">Mobiledev</a> 

      </div>
      <div class="right aligned column fsegment">
        <i class="tags icon" title="Tags"></i>  <a class="invert-link" href="/tags/Susanoo">Susanoo</a> <a class="invert-link" href="/tags/Cordova">Cordova</a> <a class="invert-link" href="/tags/Phonegap">Phonegap</a> 


      </div>
    </div>
  </div>
</div>
<br />
<br />
<div class="row author">
  <div class="ui green segment">
    <h1><img class="ui mini circular image" src="http://www.gravatar.com/avatar/15482f7b6361b463ea4b113d5a502400" title="Sameer Rahmani" style="display: inline;"> lxsameer</h1>
    <div class="ui top right attached green  label">About Author</div>
    <p><p>A Bad-ass developer who loves programming and enjoy learning new stuff. He is a senior developer in <a href="http://Yellowen.com">Yellowen</a> and manage some of the <strong>Yellowen</strong> free software projects. He enjoys software development, Electronics, Training Kyokushin Karate and play music.</p>
</p>
    <div class="ui two column grid">
      <div class="row">

        <div class="column">
          
          <span class="ohloh">
          <a href='https://www.ohloh.net/accounts/35021?ref=Tiny' target='_blank'><img alt='Ohloh profile for Sameer Rahmani' border='0' height='15' src='https://www.ohloh.net/accounts/35021/widgets/account_tiny.gif' width='80' /></a>
          </span>
          
        </div>

        <div class="right aligned column">
          
          <a href="http://www.lxsameer.com"><i class="large globe icon"></i></a>
          
          
          <a href="http://twitter.com/lxsameer"><i class="large twitter icon"></i></a>
          
          
          <a href="http://github.com/lxsameer"><i class="large github icon"></i></a>
          
          
          <a href="ir.linkedin.com/pub/sameer-rahmani/54/407/423/"><i class="large linkedin icon"></i></a>
          
    </div></div></div>
  </div>
</div>

<br /><br />
<div class="row comment">
  <div class="ui segment">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'lxblog'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>

          </div>
        </div>
      </div>
      <footer>
        <div class="ui two column page grid">
          <div class="row">
            <div class="column left aligned">
              <span>© 2012-2015 <a class="invert" href="http://www.lxsameer.com">@lxsameer</a></span>
            </div>
            <div class="column right aligned">
              <!-- Last build: 2016-05-27 -->
              <a href="https://www.easyname.ch/de/hosting"><img src="http://assets.iranonrails.ir/images/easyname_grey.png" alt="domain" style="height: 20px" /></a>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script>
     $(".ui.dropdown").dropdown();
     $(".ui.computer.sidebar").sidebar('setting', 'transision', 'push').sidebar('attach events', '.toggle.button.computer');
     $(".ui.mobile.sidebar").sidebar('attach events', '.toggle.button.mobile');
     $('.special.cards .image').dimmer({
         on: 'hover'
     });
     $('.ui.rating').rating('disable', true);
     $('.tada').transition('set looping').transition('tada', '600ms');
    </script>

    <script id="push-template" type="x-tmpl-mustache">
      <div class="push item">
        <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Pushed to <span class="branch"><div class="ui mini label">[[ branch ]]</div></span> at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
        [[#commits]]
          <div class="item">
            <a href="https://www.github.com/[[ repo ]]/commit/[[ sha ]]"><span class="ui [[color ]] tiny label">[[ short_sha ]]</span> </a><spen class="desc">  [[ message ]] </spen>
          </div>
        [[/commits]]
        </div>
      </div>
    </script>

    <script id="create-template" type="x-tmpl-mustache">
      <div class="create item">
     <img class="ui avatar image" src="/assets/avatar-ffcf03e02f67bd5b90d6ab9eba3bb2b8.jpeg"/>
        <div class="content">
          <div class="header">
            Created a new [[ type ]] at <a href="https://www.github.com/[[ repo ]]">[[ repo ]]</a>
          </div>
          <div class="description">[[ date ]]</div>
        </div>
        <div class="list">
          <div class="item">
            <div class='desc'><div class="ui tiny [[ color ]] label">[[ ref ]]</div> [[ desc ]] </div>
          </div>
        </div>
      </div>
    </script>
    <script>
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

     ga('create', 'UA-64266845-1', 'auto');
     ga('send', 'pageview');

    </script>
  </body>
</html>
